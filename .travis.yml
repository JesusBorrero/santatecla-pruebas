language: java

  travis env set DOCKER_USERNAME sigma98
  travis env set DOCKER_PASSWORD santatecla

services:
  - docker

script:
  - echo "$TRAVIS_BRANCH"
  - cd front
  
  # Build angular app
  - docker run --rm --name angular-cli -v ${PWD}:/angular -w /angular node /bin/bash -c "npm install; npm run build"
  
  - cd ../back
  
  # Copy new generated resources on back static
  - mkdir -p "src/main/resources/static/" && cp -r ../front/dist/front/* src/main/resources/static/

  # Create jar
  - docker run -it --rm -v ${PWD}:/usr/src/project -w /usr/src/project maven:alpine mvn -DskipTests package
 
  # Build docker image
  - if [ "$BRANCH" = "master" ]; then  mkdir -p "../docker/build/" && cp -r target/back-0.0.1-SNAPSHOT.jar ../docker/build/
  - if [ "$BRANCH" = "master" ]; then  docker build -t sigma98/santatecla-pruebas; fi
  
  # Push to Docker Hub
  - if [ "$BRANCH" = "master" ]; then  docker push -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD" sigma98/santatecla-pruebas; fi
  
